"use strict";(self.webpackChunkjs_and_ts_in_depth_elective=self.webpackChunkjs_and_ts_in_depth_elective||[]).push([[5767],{8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>o});var a=r(6540);const t={},i=a.createContext(t);function c(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),a.createElement(i.Provider,{value:n},e.children)}},8521:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>a,toc:()=>s});const a=JSON.parse('{"id":"advanced_concepts/request_cancellation_and_abortcontroller","title":"Cancelaci\xf3n de peticiones y AbortController","description":"AbortController es una interfaz del navegador que permite cancelar peticiones Fetch antes de que se completen, mediante una se\xf1al AbortSignal. Es ideal cuando necesitas cancelar peticiones por timeout, navegaci\xf3n, cierre de sesi\xf3n, b\xfasqueda din\xe1mica, etc.","source":"@site/docs/03_advanced_concepts/07_request_cancellation_and_abortcontroller.md","sourceDirName":"03_advanced_concepts","slug":"/advanced_concepts/request_cancellation_and_abortcontroller","permalink":"/JS_and_TS_In-depth_Elective/en/docs/advanced_concepts/request_cancellation_and_abortcontroller","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03_advanced_concepts/07_request_cancellation_and_abortcontroller.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Manejo avanzado de errores con try/catch","permalink":"/JS_and_TS_In-depth_Elective/en/docs/advanced_concepts/advanced_error_handling_with_trycatch"},"next":{"title":"Closures: definici\xf3n y usos pr\xe1cticos","permalink":"/JS_and_TS_In-depth_Elective/en/docs/advanced_concepts/closures_definition_and_practical_uses"}}');var t=r(4848),i=r(8453);const c={sidebar_position:7},o="Cancelaci\xf3n de peticiones y AbortController",l={},s=[{value:"Estructura b\xe1sica",id:"estructura-b\xe1sica",level:2},{value:"Ejemplo: B\xfasqueda en tiempo real",id:"ejemplo-b\xfasqueda-en-tiempo-real",level:2},{value:"Uso de AbortController para cancelar una petici\xf3n fetch",id:"uso-de-abortcontroller-para-cancelar-una-petici\xf3n-fetch",level:2},{value:"Integraci\xf3n avanzada",id:"integraci\xf3n-avanzada",level:2},{value:"Buenas pr\xe1cticas",id:"buenas-pr\xe1cticas",level:2},{value:"Referencias",id:"referencias",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"cancelaci\xf3n-de-peticiones-y-abortcontroller",children:"Cancelaci\xf3n de peticiones y AbortController"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"AbortController"})," es una interfaz del navegador que permite ",(0,t.jsx)(n.strong,{children:"cancelar peticiones Fetch"})," antes de que se completen, mediante una se\xf1al ",(0,t.jsx)(n.code,{children:"AbortSignal"}),". Es ideal cuando necesitas cancelar peticiones por timeout, navegaci\xf3n, cierre de sesi\xf3n, b\xfasqueda din\xe1mica, etc."]}),"\n",(0,t.jsx)(n.h2,{id:"estructura-b\xe1sica",children:"Estructura b\xe1sica"}),"\n",(0,t.jsx)(n.p,{children:"Para hacer uso de la cancelaci\xf3n de peticiones se debe:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Crear una instancia de ",(0,t.jsx)(n.code,{children:"AbortController"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Acceder a la propiedad ",(0,t.jsx)(n.code,{children:"signal"})," de la instancia y compartirla dentro de las opciones de la petici\xf3n fetch."]}),"\n",(0,t.jsx)(n.li,{children:"En cualquier momento se puede cancelar la petici\xf3n mediante el controlador."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"showLineNumbers",children:"const controller = new AbortController();\nconst signal = controller.signal;\n\nfetch('/api/data', { signal })\n  .then(res => res.json())\n  .then(data => console.log(data))\n  .catch(error => {\n    if (error.name === 'AbortError') {\n      console.log('Petici\xf3n cancelada');\n    } else {\n      console.error('Otro error:', error);\n    }\n  });\n\n// En alg\xfan momento:\n// highlight-next-line\ncontroller.abort(); // Esto cancela la petici\xf3n\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Tambi\xe9n podemos aplicar el concepto dentro de ",(0,t.jsx)(n.code,{children:"async"}),"/",(0,t.jsx)(n.code,{children:"await"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"showLineNumbers",children:"async function fetchWithCancel(url: string, controller: AbortController) {\n  try {\n    const response = await fetch(url, { signal: controller.signal });\n    if (!response.ok) throw new Error('Error HTTP');\n    return await response.json();\n  } catch (err) {\n    if ((err as Error).name === 'AbortError') {\n      console.warn('La petici\xf3n fue abortada');\n    } else {\n      throw err;\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"ejemplo-b\xfasqueda-en-tiempo-real",children:"Ejemplo: B\xfasqueda en tiempo real"}),"\n",(0,t.jsx)(n.p,{children:"Definimos una funci\xf3n uqe realizar\xe1 una b\xfasqueda usando los valores ingresados por el usuario:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"showLineNumbers",children:"let currentController: AbortController | null = null;\n\nasync function search(query: string) {\n  if (currentController) {\n    currentController.abort(); // Cancela b\xfasqueda anterior\n  }\n\n  currentController = new AbortController();\n\n  try {\n    const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`, {\n      signal: currentController.signal,\n    });\n\n    const results = await res.json();\n    console.log('Resultados:', results);\n  } catch (err) {\n    if ((err as Error).name === 'AbortError') {\n      console.log('B\xfasqueda anterior cancelada');\n    } else {\n      console.error('Error en b\xfasqueda:', err);\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Cada que el usuario ingresa un valor en el input, la funci\xf3n es llamada y cancela la petici\xf3n anterior si se encuentra activa, y lanza una nueva petici\xf3n."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"showLineNumbers",children:"const input = document.querySelector('#busqueda') as HTMLInputElement;\n\ninput.addEventListener('input', () => {\n  const query = input.value.trim();\n  if (query.length > 2) {\n    search(query);\n  }\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"uso-de-abortcontroller-para-cancelar-una-petici\xf3n-fetch",children:"Uso de AbortController para cancelar una petici\xf3n fetch"}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    autonumber\n    participant Usuario\n    participant App\n    participant AbortController\n    participant FetchAPI\n    participant Servidor\n\n    Usuario->>App: Inicia acci\xf3n (ej. b\xfasqueda)\n    App->>AbortController: Crea instancia y obtiene signal\n    App->>FetchAPI: Ejecuta fetch(url, { signal })\n    FetchAPI->>Servidor: Env\xeda petici\xf3n HTTP\n\n    Usuario->>App: Cambia acci\xf3n / abandona vista\n    App->>AbortController: Llama .abort()\n    AbortController--\x3e>FetchAPI: Dispara evento de cancelaci\xf3n\n    FetchAPI--\x3e>App: Lanza excepci\xf3n AbortError\n\n    App->>App: Captura AbortError en catch()\n    App->>Usuario: Muestra mensaje o ignora error"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"El usuario ejecuta una acci\xf3n en la plataforma."}),"\n",(0,t.jsx)(n.li,{children:"La app recibe el llamado, crea una instancia de AbortController, y obtiene el signal."}),"\n",(0,t.jsx)(n.li,{children:"A su vez, la app ejecuta un fetch a la URL y le comparte como propiedad el signal creado."}),"\n",(0,t.jsx)(n.li,{children:"La FetchAPI env\xeda una petici\xf3n HTTP al servidor con la solicitud del usuario."}),"\n",(0,t.jsx)(n.li,{children:"El usuario cambia de acci\xf3n o abandona la vista en la que se encuentra."}),"\n",(0,t.jsxs)(n.li,{children:["El cambio es detectado por la app y llama a ",(0,t.jsx)(n.code,{children:".abort()"})," para detener la petici\xf3n."]}),"\n",(0,t.jsx)(n.li,{children:"La instancia de AbortController dispara el evento de cancelaci\xf3n."}),"\n",(0,t.jsx)(n.li,{children:"La FetchAPI lanza una excepci\xf3n por cancelaci\xf3n de la petici\xf3n."}),"\n",(0,t.jsxs)(n.li,{children:["La excepci\xf3n es atrapada en el bloque ",(0,t.jsx)(n.code,{children:"try/catch"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"La app toma la decisi\xf3n de mostrar un error al usuario, o de manejarlo internamente y continuar con la ejecuci\xf3n de la aplicaci\xf3n."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"integraci\xf3n-avanzada",children:"Integraci\xf3n avanzada"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Usando timeout manual:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"showLineNumbers",children:"function fetchWithTimeout(url: string, timeout = 5000) {\n  const controller = new AbortController();\n\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  return fetch(url, { signal: controller.signal })\n    .finally(() => clearTimeout(timeoutId));\n}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Con componentes de UI, por ejemplo en Angular:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"showLineNumbers",children:"ngOnDestroy(): void {\n  this.controller.abort(); // Evita memory leaks si el usuario abandona el componente\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"buenas-pr\xe1cticas",children:"Buenas pr\xe1cticas"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Pr\xe1ctica"}),(0,t.jsx)(n.th,{children:"Recomendado"}),(0,t.jsx)(n.th,{children:"Evitar"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["Usar ",(0,t.jsx)(n.code,{children:"AbortController"})," para b\xfasquedas din\xe1micas, navegaci\xf3n, cierre de sesi\xf3n"]}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["Revisar siempre el nombre del error (",(0,t.jsx)(n.code,{children:"AbortError"}),")"]}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["Llamar ",(0,t.jsx)(n.code,{children:".abort()"})," sin necesidad real"]}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"\u274c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Usar m\xfaltiples controladores para m\xfaltiples peticiones independientes"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["Compartir ",(0,t.jsx)(n.code,{children:"controller.signal"})," entre distintas peticiones si no deben cancelarse juntas"]}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"\u274c"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"referencias",children:"Referencias"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Mozilla Developer Network. (s.f.). ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/AbortController",children:"AbortController"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Mozilla Developer Network. (s.f.). ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",children:"Fetch API"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Flanagan, D. (2020). JavaScript: The Definitive Guide (7th ed.). O\u2019Reilly Media."}),"\n",(0,t.jsxs)(n.li,{children:["Google. (s.f.). ",(0,t.jsx)(n.a,{href:"https://google.github.io/styleguide/jsguide.html",children:"JavaScript Style Guide"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["TypeScript Handbook. (s.f.). ",(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/",children:"Working with APIs"}),"."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);